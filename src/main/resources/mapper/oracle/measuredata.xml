<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.lunalabs.central.mapper.oracle.MeasureDataMapper">

	<insert id="save">
		INSERT INTO MeasureData(mid, sid, pid, patientUserId, parame, valueUnit, value, startTime, endTime)
		VALUES(MeasureData_seq.nextval,#{sid},#{pid},#{patientUserId},#{parame},#{valueUnit},#{value},TO_TIMESTAMP(CONCAT(#{startTime}, '000'), 'YY.MM.DD-HH24:MI:SS.FF6'), TO_TIMESTAMP(CONCAT(#{endTime}, '000'), 'YY.MM.DD-HH24:MI:SS.FF6'))
	</insert>

	<delete id="deleteById">
		DELETE FROM MeasureData WHERE mid = #{id}
	</delete>

	<delete id="deleteAll">
		DELETE FROM MeasureData
	</delete>

	<!-- <update id="update"> UPDATE MeasureData SET name=#{name}, code=#{code} WHERE mid = #{id} </update> -->


	<select id="findAll" resultType="net.lunalabs.central.domain.measuredata.MeasureData">
		<![CDATA[
		select * from MeasureData order by mid desc 
		]]>
	</select>



	<select id="findById" resultType="net.lunalabs.central.domain.measuredata.MeasureData">
		<![CDATA[
		select * from MeasureData where mid=#{id} 
		]]>
	</select>


<!-- 	<insert id="insertBatch">
		INSERT INTO MeasureData(mid, sid, pid, patientUserId, parame, valueUnit, value, startTime, endTime)
		VALUES
		<foreach collection="list" index="index" item="data" separator="," open="INSERT ALL" close="SELECT * FROM DUAL">
			(
			MeasureData_seq.nextval,
			#{data.sid},
			#{data.pid},
			#{data.patientUserId},
			#{data.parame},
			#{data.valueUnit},
			#{data.value},
			TO_TIMESTAMP(CONCAT(#{data.startTime}, '000'), 'YY.MM.DD-HH24:MI:SS.FF6'),
			TO_TIMESTAMP(CONCAT(#{data.endTime}, '000'), 'YY.MM.DD-HH24:MI:SS.FF6')
			)
		</foreach>
	</insert> -->



<!-- useGeneratedKeys="true" keyColumn="mid" keyProperty="mid" --> 
 	<insert id="insertBatch" >
		<foreach collection="list" item="data" close="SELECT * FROM DUAL"  open="INSERT ALL" separator=" ">
			into MeasureData(mid, sid, pid, patientUserId, parame, valueUnit, value, startTime, endTime)
			values 
			(
			get_seq( 'MeasureData_seq' ),
			#{data.sid},
			#{data.pid},
			#{data.patientUserId},
			#{data.parame},
			#{data.valueUnit},
			#{data.value},
			TO_TIMESTAMP(CONCAT(#{data.startTime}, '000'), 'YY.MM.DD-HH24:MI:SS.FF6'),
			TO_TIMESTAMP(CONCAT(#{data.endTime}, '000'), 'YY.MM.DD-HH24:MI:SS.FF6')
			)
		</foreach>
	</insert> 
		<!-- select * from DUAL -->


</mapper>
